<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

    <!-- Primary Meta Tags -->
    <title>Safe Space COYS - Mental Health Support for Spurs Fans</title>
    <meta name="title" content="Safe Space COYS - Mental Health Support for Spurs Fans">
    <meta name="description" content="A sanctuary for the long-suffering. Track your mood, use coping tools, and connect with fellow Tottenham supporters who understand.">
    <meta name="keywords" content="Spurs, Tottenham, COYS, mental health, anxiety, football, coping, mindfulness, CBT">
    <meta name="author" content="Safe Space COYS">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://safespacecoys.com/">
    <meta property="og:title" content="Safe Space COYS - Mental Health Support for Spurs Fans">
    <meta property="og:description" content="A sanctuary for the long-suffering. Track your mood, use coping tools, and connect with fellow supporters.">
    <meta property="og:image" content="https://safespacecoys.com/og-image.png">
    <meta property="og:locale" content="en_GB">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://safespacecoys.com/">
    <meta property="twitter:title" content="Safe Space COYS - Mental Health Support for Spurs Fans">
    <meta property="twitter:description" content="A sanctuary for the long-suffering. Track your mood, use coping tools, and connect with fellow supporters.">
    <meta property="twitter:image" content="https://safespacecoys.com/og-image.png">

    <!-- PWA / Mobile -->
    <meta name="theme-color" content="#132257">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SafeSpace">
    <link rel="manifest" href="/manifest.json">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://safespacecoys.com/">

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <a href="#main" class="skip-link">Skip to main content</a>
    <div class="spurs-stripe" aria-hidden="true"></div>
    <div class="app-container">
        <header class="mobile-topbar" role="banner">
            <button class="mobile-menu-btn" data-action="toggle-sidebar" aria-label="Open menu">â˜°</button>
            <div class="mobile-title">Safe Space COYS</div>
            <button class="mobile-privacy-btn" data-action="open-privacy" aria-label="Privacy">ğŸ”’</button>
        </header>
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">ğŸ“</div>
                <div class="logo-text">Safe Space<br><span>COYS</span></div>
            </div>
            <div class="tagline">A sanctuary for the long-suffering</div>
            <div class="motto">Audere est Facere</div>

            <div class="next-match">
                <div class="next-match-label"><span class="live-dot"></span>Next Match</div>
                <div class="match-teams">
                    <div class="team">
                        <div class="team-badge" id="homeTeamBadge">ğŸ”´</div>
                        <div class="team-name" id="homeTeamName">Man United</div>
                    </div>
                    <div class="match-vs">vs</div>
                    <div class="team">
                        <div class="team-badge" id="awayTeamBadge">ğŸ¤</div>
                        <div class="team-name" id="awayTeamName">Spurs</div>
                    </div>
                </div>
                <div class="match-info">
                    <div class="match-info-item"><span>ğŸ“</span><span id="matchVenue">Old Trafford</span></div>
                    <div class="match-info-item"><span>ğŸ†</span><span id="matchCompetition">PL</span></div>
                </div>
                <div class="countdown">
                    <div class="countdown-item"><div class="countdown-value" id="countdownDays">2</div><div class="countdown-label">Days</div></div>
                    <div class="countdown-item"><div class="countdown-value" id="countdownHours">14</div><div class="countdown-label">Hrs</div></div>
                    <div class="countdown-item"><div class="countdown-value" id="countdownMinutes">32</div><div class="countdown-label">Min</div></div>
                    <div class="countdown-item"><div class="countdown-value" id="countdownSeconds">45</div><div class="countdown-label">Sec</div></div>
                </div>
            </div>

            <div class="drought-counter">
                <div class="drought-label">Trophy Drought</div>
                <div class="drought-number" id="droughtDays">6,205</div>
                <div class="drought-unit">days without a trophy</div>
            </div>

            <nav class="nav-section">
                <div class="nav-label">Main</div>
                <button class="nav-item active" data-page="home"><span class="nav-icon">ğŸ </span><span>Home</span></button>
                <button class="nav-item" data-page="toolkit"><span class="nav-icon">ğŸ§°</span><span>Coping Toolkit</span></button>
                <button class="nav-item locked" data-page="community"><span class="nav-icon">ğŸ‘¥</span><span>Community</span></button>
            </nav>
            <nav class="nav-section">
                <div class="nav-label">Personal</div>
                <button class="nav-item" data-page="profile"><span class="nav-icon">ğŸ‘¤</span><span>My Profile</span></button>
            </nav>
        </aside>

        <main class="main-content" id="main" role="main">
            <!-- Home Page - Simplified -->
            <div class="page active" id="page-home">
                <header class="page-header">
                    <h1 class="page-title">How are you holding up?</h1>
                    <p class="page-subtitle">Itâ€™s been a week, hasnâ€™t it? Take a breath before the next kickâ€‘off.</p>
                </header>
                <div class="matchday-banner" id="matchdayBanner">
                    <div class="matchday-title">Matchday Mode</div>
                    <div class="matchday-text">Nerves are normal. Audere est Facere. Start with a 60â€‘second reset.</div>
                    <button class="btn btn-secondary" data-action="open-tool" data-tool="breathing">Start Breathing</button>
                </div>

                <section class="mood-section">
                    <h2 class="mood-question">How Spursy are you feeling today?</h2>
                    <p class="mood-subtext">Select an emotion to start your check-in</p>
                    <div class="mood-options">
                        <button class="mood-option highlight" data-action="select-mood" data-emotion="frustrated" data-emoji="ğŸ˜¤"><div class="mood-emoji">ğŸ˜¤</div><div class="mood-label">Frustrated</div><div class="mood-spurs">"Same old story"</div></button>
                        <button class="mood-option highlight" data-action="select-mood" data-emotion="anxious" data-emoji="ğŸ˜°"><div class="mood-emoji">ğŸ˜°</div><div class="mood-label">Anxious</div><div class="mood-spurs">"2-0 lead energy"</div></button>
                        <button class="mood-option" data-action="select-mood" data-emotion="sad" data-emoji="ğŸ˜”"><div class="mood-emoji">ğŸ˜”</div><div class="mood-label">Sad</div><div class="mood-spurs">"Post-match blues"</div></button>
                        <button class="mood-option" data-action="select-mood" data-emotion="numb" data-emoji="ğŸ˜"><div class="mood-emoji">ğŸ˜</div><div class="mood-label">Numb</div><div class="mood-spurs">"Can't hurt anymore"</div></button>
                        <button class="mood-option highlight" data-action="select-mood" data-emotion="hopeful" data-emoji="ğŸ¤"><div class="mood-emoji">ğŸ¤</div><div class="mood-label">Hopeful</div><div class="mood-spurs">"This is our year"</div></button>
                        <button class="mood-option" data-action="select-mood" data-emotion="content" data-emoji="ğŸ˜Š"><div class="mood-emoji">ğŸ˜Š</div><div class="mood-label">Content</div><div class="mood-spurs">"Win or lose, COYS"</div></button>
                    </div>
                </section>

                <section>
                    <div class="section-header"><h2 class="section-title">Quick Coping Tools</h2></div>
                    <div class="tools-grid">
                        <button class="tool-card" data-action="open-tool" data-tool="breathing"><div class="tool-icon">ğŸŒ¬ï¸</div><div class="tool-name">Box Breathing</div><div class="tool-duration">1 min</div></button>
                        <button class="tool-card" data-action="open-tool" data-tool="grounding"><div class="tool-icon">ğŸ¯</div><div class="tool-name">5-4-3-2-1 Ground</div><div class="tool-duration">2 min</div></button>
                        <button class="tool-card" data-action="open-tool" data-tool="reframe"><div class="tool-icon">ğŸ§ </div><div class="tool-name">Thought Reframe</div><div class="tool-duration">3 min</div></button>
                        <button class="tool-card" data-action="open-tool" data-tool="affirmation"><div class="tool-icon">ğŸ’ª</div><div class="tool-name">Affirmations</div><div class="tool-duration">30 sec</div></button>
                    </div>
                </section>
            </div>

            <!-- Toolkit Page -->
            <div class="page" id="page-toolkit">
                <header class="page-header"><h1 class="page-title">Coping Toolkit</h1><p class="page-subtitle">Evidence-based techniques for the long-suffering fan</p></header>
                <div class="cards-grid">
                    <div class="card"><div class="card-header"><div class="card-icon mood">ğŸŒ¬ï¸</div><span class="card-badge">Breathing</span></div><h3 class="card-title">Box Breathing</h3><p class="card-description">A clinically-proven 4-4-4-4 breathing technique to calm your nervous system. Perfect for VAR decisions and penalty shootouts.</p><button class="card-action" data-action="open-tool" data-tool="breathing">Start Exercise â†’</button></div>
                    <div class="card"><div class="card-header"><div class="card-icon toolkit">ğŸ¯</div><span class="card-badge">Grounding</span></div><h3 class="card-title">5-4-3-2-1 Technique</h3><p class="card-description">Ground yourself in the present moment when anxiety takes over. Uses your five senses to bring you back to reality.</p><button class="card-action" data-action="open-tool" data-tool="grounding">Start Exercise â†’</button></div>
                    <div class="card"><div class="card-header"><div class="card-icon community">ğŸ§ </div><span class="card-badge">CBT</span></div><h3 class="card-title">Thought Reframing</h3><p class="card-description">"We always bottle it" - Let's examine this thought with cognitive behavioral therapy techniques. Is it really true?</p><button class="card-action" data-action="open-tool" data-tool="reframe">Start Exercise â†’</button></div>
                    <div class="card"><div class="card-header"><div class="card-icon journal">ğŸ’ª</div><span class="card-badge">Positive Psychology</span></div><h3 class="card-title">Spurs Fan Affirmations</h3><p class="card-description">Positive statements designed specifically for the Spurs fan experience. Build resilience through self-compassion.</p><button class="card-action" data-action="open-tool" data-tool="affirmation">View Affirmations â†’</button></div>
                </div>
            </div>

            <!-- Community Page -->
            <div class="page" id="page-community">
                <header class="page-header"><h1 class="page-title">Community</h1><p class="page-subtitle">A safe space for fellow sufferers.</p></header>

                <!-- New Post Form -->
                <div class="new-post-form" id="newPostForm">
                    <textarea id="newPostContent" placeholder="Share what's on your mind..." aria-label="New post content" maxlength="500"></textarea>
                    <div class="new-post-actions">
                        <div class="post-type-select">
                            <button class="post-type-btn active" data-action="select-post-type" data-type="vent">ğŸ˜¤ Vent</button>
                            <button class="post-type-btn" data-action="select-post-type" data-type="support">ğŸ¤ Support</button>
                        </div>
                        <button class="btn btn-primary" data-action="submit-post">Post</button>
                    </div>
                </div>

                <div class="community-header">
                    <button class="filter-btn active" data-filter="all">All Posts</button>
                    <button class="filter-btn" data-filter="vent">ğŸ˜¤ Vent</button>
                    <button class="filter-btn" data-filter="support">ğŸ¤ Support</button>
                    <button class="new-post-btn" data-action="toggle-new-post">âœï¸ New Post</button>
                </div>
                <div class="feed-posts" id="communityFeed"></div>
            </div>

            <!-- Profile Page -->
            <div class="page" id="page-profile">
                <header class="page-header"><h1 class="page-title">My Profile</h1><p class="page-subtitle">Your personal dashboard and check-in history</p></header>

                <!-- Logged Out State -->
                <div id="profileLoggedOut">
                    <div class="login-required">
                        <div class="login-required-icon">ğŸ”’</div>
                        <h2 class="login-required-title">Join the Safe Space</h2>
                        <p class="login-required-text">Sign in to track your mood history, see your stats, and connect with the community.</p>
                        <button class="btn btn-primary" data-action="open-auth">Sign In with Email</button>
                    </div>
                </div>

                <!-- Logged In State -->
                <div id="profileLoggedIn" style="display: none;">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">FS</div>
                        <div class="profile-info">
                            <div class="profile-name" id="profileName">Fellow Sufferer</div>
                            <div class="profile-email" id="profileEmail">user@example.com</div>
                            <div class="profile-since">ğŸ“ Suffering since joining</div>
                        </div>
                        <div class="profile-actions">
                            <button class="logout-btn" data-action="logout">Log Out</button>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-value" id="statCheckins">0</div><div class="stat-label">Check-ins</div></div>
                        <div class="stat-card"><div class="stat-value" id="statStreak">0</div><div class="stat-label">Day Streak</div></div>
                        <div class="stat-card"><div class="stat-value" id="statTools">0</div><div class="stat-label">Tools Used</div></div>
                        <div class="stat-card"><div class="stat-value" id="statAvgMood">--</div><div class="stat-label">Avg Mood</div></div>
                    </div>

                    <!-- Mood Chart -->
                    <div class="chart-container">
                        <div class="chart-title">Last 7 Days Mood Intensity</div>
                        <canvas id="moodChart" class="chart-canvas" aria-label="Mood intensity chart"></canvas>
                        <div class="chart-summary" id="chartSummary">Your trend will appear after your first checkâ€‘in.</div>
                        <div class="chart-empty" id="chartEmpty">Complete more check-ins to see your trend</div>
                    </div>

                    <div class="section-header"><h2 class="section-title">Recent Check-ins</h2></div>
                    <div class="history-list" id="checkinHistory">
                        <div class="history-item"><div class="history-emoji">ğŸ˜°</div><div class="history-details"><div class="history-emotion">Anxious</div><div class="history-meta">Today, 2:30 PM â€¢ Match Result</div></div><div class="history-intensity">7/10</div></div>
                        <div class="history-item"><div class="history-emoji">ğŸ¤</div><div class="history-details"><div class="history-emotion">Hopeful</div><div class="history-meta">Yesterday, 10:15 AM â€¢ Transfer News</div></div><div class="history-intensity">6/10</div></div>
                        <div class="history-item"><div class="history-emoji">ğŸ˜¤</div><div class="history-details"><div class="history-emotion">Frustrated</div><div class="history-meta">Jan 28, 8:45 PM â€¢ VAR Decision</div></div><div class="history-intensity">8/10</div></div>
                    </div>
                </div>
            </div>
        </main>
        <div class="sidebar-backdrop" data-action="close-sidebar"></div>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay" id="authModal">
        <div class="modal">
            <div class="modal-header"><h2 class="modal-title">Join the Safe Space</h2><button class="modal-close" data-action="close-auth">âœ•</button></div>
            <div class="modal-body">
                <div id="syncRequired" style="display: none;">
                    <div class="auth-icon">ğŸ”’</div>
                    <h3 class="auth-title">Cloud Sync Required</h3>
                    <p class="auth-subtitle">To create an account and join the community, enable Cloud Sync in Privacy settings. Your data stays local unless you opt in.</p>
                    <button class="btn btn-secondary" style="width: 100%;" data-action="open-privacy">Open Privacy Settings</button>
                </div>
                <div id="authForm">
                    <div class="auth-icon">ğŸ“</div>
                    <h3 class="auth-title">Welcome, Fellow Sufferer</h3>
                    <p class="auth-subtitle">Enter your email to join. We'll send you a magic link - no password needed.</p>
                    <div class="form-group"><label class="form-label">Email Address</label><input type="email" class="form-input" id="authEmail" placeholder="you@example.com"></div>
                    <div class="form-error" id="emailError">Please enter a valid email.</div>
                    <button class="btn btn-primary" style="width: 100%;" data-action="send-magic-link">Send Magic Link</button>
                    <div class="auth-benefits"><div class="auth-benefits-title">With an account you can:</div><div class="auth-benefit"><span class="auth-benefit-icon">âœ“</span><span>Track your mood history over time</span></div><div class="auth-benefit"><span class="auth-benefit-icon">âœ“</span><span>See your personal stats and insights</span></div><div class="auth-benefit"><span class="auth-benefit-icon">âœ“</span><span>Connect with the community</span></div></div>
                </div>
                <div id="emailSent" style="display: none;">
                    <div class="email-sent"><div class="email-sent-icon">ğŸ“¬</div><h3 class="email-sent-title">Check Your Inbox</h3><p class="email-sent-text">We've sent a magic link to<br><span class="email-sent-address" id="sentEmailAddress">you@example.com</span></p><p class="email-sent-text">Click the link to join. Expires in 24 hours.</p><p class="resend-link">Didn't receive it? <button class="link-btn" data-action="resend-magic-link">Resend</button></p></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Check-in Modal -->
    <div class="modal-overlay" id="checkinModal">
        <div class="modal wide">
            <div class="modal-header"><h2 class="modal-title">Mood Check-in</h2><button class="modal-close" data-action="close-checkin">âœ•</button></div>
            <div class="modal-body">
                <div class="checkin-step active" id="step1">
                    <div class="step-indicator"><div class="step-dot active"></div><div class="step-dot"></div><div class="step-dot"></div></div>
                    <h3 class="step-title">You selected: <span id="selectedEmotionLabel">Anxious</span></h3>
                    <p class="step-description">Let's explore this feeling a bit more.</p>
                    <div style="text-align: center; font-size: 64px; margin: 32px 0;" id="selectedEmotionEmoji">ğŸ˜°</div>
                </div>
                <div class="checkin-step" id="step2">
                    <div class="step-indicator"><div class="step-dot completed"></div><div class="step-dot active"></div><div class="step-dot"></div></div>
                    <h3 class="step-title">How intense is this feeling?</h3>
                    <p class="step-description">1 = barely noticeable, 10 = overwhelming</p>
                    <div class="intensity-value" id="intensityValue">5</div>
                    <div class="intensity-slider"><input id="intensitySlider" type="range" min="1" max="10" value="5"></div>
                    <div class="slider-labels"><span>Manageable</span><span>Moderate</span><span>Overwhelming</span></div>
                </div>
                <div class="checkin-step" id="step3">
                    <div class="step-indicator"><div class="step-dot completed"></div><div class="step-dot completed"></div><div class="step-dot active"></div></div>
                    <h3 class="step-title">What triggered this?</h3>
                    <p class="step-description">Optional - helps identify patterns</p>
                    <div class="trigger-tags">
                        <button class="trigger-tag" data-action="select-trigger">âš½ Match Result</button>
                        <button class="trigger-tag" data-action="select-trigger">ğŸ“º VAR Decision</button>
                        <button class="trigger-tag" data-action="select-trigger">ğŸ”„ Transfer News</button>
                        <button class="trigger-tag" data-action="select-trigger">ğŸŸï¸ Derby Day</button>
                        <button class="trigger-tag" data-action="select-trigger">ğŸ“± Social Media</button>
                        <button class="trigger-tag" data-action="select-trigger">ğŸ’­ General Life</button>
                    </div>
                </div>
                <div class="checkin-step" id="step4">
                    <div class="result-card"><div class="result-icon">âœ…</div><h3 class="result-title">Check-in Saved</h3><p class="result-message">Well done for taking a moment to check in. Based on your response, try one of these tools:</p></div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 24px;">
                        <button class="tool-card" data-action="open-tool" data-tool="breathing"><div class="tool-icon">ğŸŒ¬ï¸</div><div class="tool-name">Breathing</div></button>
                        <button class="tool-card" data-action="open-tool" data-tool="grounding"><div class="tool-icon">ğŸ¯</div><div class="tool-name">Grounding</div></button>
                    </div>
                </div>
            </div>
            <div class="modal-footer" id="modalFooter"><button class="btn btn-secondary" data-action="prev-step">Back</button><button class="btn btn-primary" data-action="next-step">Continue</button></div>
        </div>
    </div>

    <!-- Tool Modal -->
    <div class="modal-overlay" id="toolModal">
        <div class="modal wide">
            <div class="modal-header"><h2 class="modal-title" id="toolModalTitle">Tool</h2><button class="modal-close" data-action="close-tool">âœ•</button></div>
            <div class="modal-body" id="toolModalBody"></div>
        </div>
    </div>

    <!-- Privacy Modal -->
    <div class="modal-overlay" id="privacyModal">
        <div class="modal">
            <div class="modal-header"><h2 class="modal-title">Privacy & Data</h2><button class="modal-close" data-action="close-privacy">âœ•</button></div>
            <div class="modal-body">
                <div class="privacy-content">
                    <h3>ğŸ”’ Your Data Stays Local (by default)</h3>
                    <p>All your mood check-ins, tool usage, and preferences are stored <strong style="color: var(--white);">only on your device</strong> using your browser's local storage.</p>

                    <h3>â˜ï¸ Optional Cloud Sync</h3>
                    <p>If you want to create an account and join the community, you can enable Cloud Sync. This will store your check-ins and posts securely on our server so they follow you across devices.</p>
                    <div class="privacy-toggle">
                        <label for="syncToggle">Enable Cloud Sync</label>
                        <input type="checkbox" id="syncToggle" aria-label="Enable Cloud Sync">
                    </div>

                    <h3>ğŸ“Š What We Store</h3>
                    <ul>
                        <li>Mood check-in history (emotion, intensity, trigger, date)</li>
                        <li>Tool usage count and feedback</li>
                        <li>Community posts you create</li>
                        <li>Email (for login only)</li>
                    </ul>

                    <h3>ğŸš« What We Don't Do</h3>
                    <ul>
                        <li>Sell your information</li>
                        <li>Track you across websites</li>
                        <li>Use cookies for advertising</li>
                    </ul>

                    <h3>ğŸ—‘ï¸ Delete Your Data</h3>
                    <p>Clear your browser's local storage to remove all data, or use the button below:</p>
                    <button class="btn btn-secondary" style="margin-top: 12px; width: 100%;" data-action="clear-data">Clear All My Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
        <button class="mobile-nav-item active" data-page="home" aria-label="Home">
            <span class="nav-icon">ğŸ </span>Home
        </button>
        <button class="mobile-nav-item" data-page="toolkit" aria-label="Toolkit">
            <span class="nav-icon">ğŸ§°</span>Tools
        </button>
        <button class="mobile-nav-item" data-page="community" aria-label="Community">
            <span class="nav-icon">ğŸ‘¥</span>Community
        </button>
        <button class="mobile-nav-item" data-page="profile" aria-label="Profile">
            <span class="nav-icon">ğŸ‘¤</span>Profile
        </button>
    </nav>

    <script src="/js/utils.js"></script>
    <script src="/js/state.js"></script>
    <script src="/js/sync.js"></script>
    <script src="/js/navigation.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/checkin.js"></script>
    <script src="/js/tools.js"></script>
    <script src="/js/community.js"></script>
    <script src="/js/privacy.js"></script>
    <script src="/js/init.js"></script>
</body>
</html>
